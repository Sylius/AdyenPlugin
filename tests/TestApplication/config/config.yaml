imports:
    - { resource: "@SyliusRefundPlugin/Resources/config/app/config.yml" }
    - { resource: "@SyliusAdyenPlugin/config/config.yaml" }
    - { resource: "services_test.php" }

parameters:
    sylius_adyen_api_platform_mapping_path: '%kernel.project_dir%/../../../config/api_resources/'
    sylius_refund.supported_gateways:
        - offline
        - adyen

doctrine:
    orm:
        entity_managers:
            default:
                mappings:
                    TestApplication:
                        is_bundle: false
                        type: attribute
                        dir: '%kernel.project_dir%/../../../tests/TestApplication/src/Entity'
                        prefix: Tests\Sylius\AdyenPlugin

sylius_product:
    resources:
        product_variant:
            classes:
                model: Tests\Sylius\AdyenPlugin\Entity\ProductVariant

sylius_payment:
    resources:
        payment_method:
            classes:
                repository: Tests\Sylius\AdyenPlugin\Repository\PaymentMethodRepository

sylius_resource:
    resources:
        sylius_refund.refund_payment:
            classes:
                repository: Tests\Sylius\AdyenPlugin\Repository\RefundPaymentRepository

monolog:
    channels: ["app", "doctrine", "event", "php", "adyen"]

    handlers:
        adyen_file:
            type: rotating_file
            path: "%kernel.logs_dir%/adyen-%kernel.environment%.log"
            max_files: 30
            level: info
            channels: ["adyen"]
            formatter: monolog.formatter.line

        adyen_doctrine:
            type: service
            id: sylius_adyen.logging.monolog.doctrine_handler
            channels: ["adyen"]

        console:
            type: console
            process_psr_3_messages: false
            channels: ["!event", "!doctrine"]

        main:
            type: stream
            path: "%kernel.logs_dir%/%kernel.environment%.log"
            level: debug
            channels: ["!event", "!doctrine", "!php", "!adyen"]
            formatter: monolog.formatter.line

        doctrine:
            type: stream
            path: "%kernel.logs_dir%/%kernel.environment%_doctrine.log"
            level: warning
            channels: ["doctrine"]

        php:
            type: stream
            path: "%kernel.logs_dir%/%kernel.environment%_php.log"
            level: info
            channels: ["php"]

        dedup:
            type: deduplication
            handler: main

when@dev:
    monolog:
        handlers:
            main:
                type: stream
                path: "%kernel.logs_dir%/dev_app.log"
                level: error
                channels: ["!event", "!doctrine", "!php", "!adyen"]
                formatter: monolog.formatter.line

            doctrine:
                type: stream
                path: "%kernel.logs_dir%/dev_doctrine.log"
                level: warning
                channels: ["doctrine"]

            php:
                type: stream
                path: "%kernel.logs_dir%/dev_php.log"
                level: debug
                channels: ["php"]

            adyen_file:
                type: rotating_file
                path: "%kernel.logs_dir%/adyen-dev.log"
                max_files: 14
                level: debug
                channels: ["adyen"]
                formatter: monolog.formatter.line

            firephp:
                type: firephp
                level: info
                channels: ["!doctrine", "!event", "!php"]

when@prod:
    monolog:
        handlers:
            fingers:
                type: fingers_crossed
                action_level: warning
                handler: dedup
                buffer_size: 200

            adyen_file:
                type: rotating_file
                path: "%kernel.logs_dir%/adyen-%kernel.environment%.log"
                max_files: 30
                level: info
                channels: ["adyen"]
                formatter: monolog.formatter.line
